p8105_hw3_nl2835
================
Nancy Le
2023-10-10

``` r
data("instacart")
```

### Problem 1

The Instacart dataset has 1384617 observations and 15 variables, which
include `order_id`, `product_id`, the `user_id`, `product_name`s, and
which location of the supermarket the products were found (as in, the
`department` and `aisle`).

User IDs ranged from 1 to 206209.

``` r
num_aisles <- instacart |> 
  select(aisle) |> 
  distinct() |> 
  nrow()

print(num_aisles)
```

    ## [1] 134

There are 134 aisles.

``` r
count_items_aisle <- instacart |> 
 group_by(aisle_id) |> 
 count() |> 
  arrange(desc(n))
```

The aisle with the most items ordered from is 83.

``` r
instacart = instacart |> 
  group_by(aisle_id) |> 
  mutate(total_product_count = n()) |> 
  select(order_id, aisle_id, product_id, total_product_count, everything())
```

``` r
subset_instacart = instacart |> 
  filter(total_product_count > 10000) 
```

``` r
subset_instacart |> 
  ggplot(aes(x = aisle_id, y = total_product_count)) + geom_point() + labs(
    title = "Number of Products Ordered by Aisle",
    x = "Aisle ID",
    y = "Number of Products Ordered",
    caption = "Data from Instacart") +
  scale_x_continuous(
    breaks = seq(0, 135, by = 1)
  )
```

<img src="p8105_hw3_nl2835_files/figure-gfm/scatterplot items by aisle-1.png" width="90%" />

``` r
#need to go back and fix aisle id labels - maybe should use text labels above just the top 3 product counts?
```

``` r
subset_instacart |> 
ggplot(aes(x = aisle_id, y = total_product_count)) + 
  geom_bar(stat = "identity") + 
  scale_x_discrete(labels = subset_instacart$aisle_id)
```

<img src="p8105_hw3_nl2835_files/figure-gfm/bar plot items by aisle-1.png" width="90%" />

``` r
three_depts = instacart |> 
  filter(aisle == c("baking ingredients", "dog food care", "packaged vegetables fruits")) |> 
  group_by(product_id, aisle_id) 
```

``` r
three_depts = three_depts |> 
  mutate(product_count = 1) |> 
  select(aisle_id, aisle, product_id, product_name, product_count, everything()) 
```

``` r
top_three = three_depts |> 
  group_by(aisle_id, product_name) |> 
  summarize(product_count = sum(product_count)) |> 
  arrange(desc(product_count))  |> 
  slice_head(n = 3) |> 
  select(product_name, product_count, aisle_id) 
```

    ## `summarise()` has grouped output by 'aisle_id'. You can override using the
    ## `.groups` argument.

``` r
library(knitr)
kable(top_three, caption = "Top 3 Products By Aisle")
```

| product_name                                  | product_count | aisle_id |
|:----------------------------------------------|--------------:|---------:|
| Light Brown Sugar                             |           157 |       17 |
| Pure Baking Soda                              |           126 |       17 |
| Organic Unbleached All-Purpose Flour          |           108 |       17 |
| Dog Snacks, Medium                            |            10 |       40 |
| Small Dog Biscuits                            |            10 |       40 |
| Chicken and Liver Canine Cuisine Wet Dog Food |             9 |       40 |
| Organic Baby Spinach                          |          3272 |      123 |
| Organic Raspberries                           |          1851 |      123 |
| Organic Blueberries                           |          1642 |      123 |

Top 3 Products By Aisle

``` r
days_df <- 
  tibble(
    day_num = 0:6,
    day_abb = c("Sun", "Mon", "Tues", "Wed", "Thurs", "Fri", "Sat")
  )
```

``` r
replacement_vector <- setNames(days_df$day_abb, days_df$day_num)
```

``` r
pla_cic = instacart |> 
  filter(product_name == c(
    "Pink Lady Apples", "Coffee Ice Cream")) |> 
  group_by(order_dow, product_name) |>
  summarize(mean_hr = mean(order_hour_of_day)) |> 
  spread(key = order_dow, value = mean_hr) 
```

    ## `summarise()` has grouped output by 'order_dow'. You can override using the
    ## `.groups` argument.

``` r
library(knitr)
kable(pla_cic, caption = "Mean Hour Ordered")
```

| product_name     |       0 |        1 |        2 |        3 |        4 |        5 |        6 |
|:-----------------|--------:|---------:|---------:|---------:|---------:|---------:|---------:|
| Coffee Ice Cream | 12.4000 | 15.25000 | 15.76923 | 15.87500 | 14.86667 | 13.16667 | 13.88889 |
| Pink Lady Apples | 13.5625 | 11.77778 | 12.16000 | 13.11111 | 11.28571 | 12.12903 | 12.14286 |

Mean Hour Ordered

## Problem 2

``` r
data("brfss_smart2010")
```

``` r
brfss = brfss_smart2010 |> 
  janitor::clean_names() |> 
  filter(topic=="Overall Health") |> 
  drop_na(response) |> 
  mutate(response = as_factor(response)) |> 
  mutate(locationdesc = substring(locationdesc, 5)) |> 
  rename(county = locationdesc, state = locationabbr, response_prevalence = data_value)
```

``` r
states_seven_2002 = brfss |> 
  filter(year=="2002") |> 
  group_by(state) |> 
  summarize(unique_counties = n_distinct(county)) |> 
  filter(unique_counties >= 7)
```

``` r
states_seven_2010 = brfss |> 
  filter(year=="2010") |> 
  group_by(state) |> 
  summarize(unique_counties = n_distinct(county)) |> 
  filter(unique_counties >= 7)
```

#### 2002 - States \>= 7 Locations

``` r
library(knitr)
kable(states_seven_2002)
```

| state | unique_counties |
|:------|----------------:|
| CT    |               7 |
| FL    |               7 |
| MA    |               8 |
| NC    |               7 |
| NJ    |               8 |
| PA    |              10 |

#### 2010 - States \>= 7 Locations

``` r
kable(states_seven_2010)
```

| state | unique_counties |
|:------|----------------:|
| CA    |              12 |
| CO    |               7 |
| FL    |              41 |
| MA    |               9 |
| MD    |              12 |
| NC    |              12 |
| NE    |              10 |
| NJ    |              19 |
| NY    |               9 |
| OH    |               8 |
| PA    |               7 |
| SC    |               7 |
| TX    |              16 |
| WA    |              10 |

``` r
excellent = brfss |> 
  filter(response == "Excellent") |> 
  group_by(state, year) |> 
  mutate(mean_response_prevalence = mean(response_prevalence, na.rm = TRUE)) |> 
  select(year, state, mean_response_prevalence)
```

``` r
excellent |> 
  ggplot(
  aes(x = year, y = mean_response_prevalence, group = state, color = state)) + geom_line() +
  labs(
    title = "Spaghetti Plot of Mean Response Prevalence by State", 
    x = "Year", 
    y = "Response Prevalence"
  )
```

<img src="p8105_hw3_nl2835_files/figure-gfm/excellent spaghetti plot-1.png" width="90%" />

``` r
nytwopanel = brfss |> 
  filter(year == 2006 | year == 2010) |> 
  filter(state == "NY")  |>  
  group_by(state, year, county) 
```

``` r
ggplot(nytwopanel, aes(x = response_prevalence, color = response)) + 
  geom_density(alpha = .5) + 
  facet_grid(. ~ year) +
  ggtitle("Response Distribution in NY")
```

<img src="p8105_hw3_nl2835_files/figure-gfm/density plot-1.png" width="90%" />

``` r
ggplot(nytwopanel, aes(y = response_prevalence, x = response, color = county, group = county)) + 
  geom_point(alpha = .5) + 
  facet_grid(year ~ .) + 
  ggtitle("Response Distribution by County")
```

<img src="p8105_hw3_nl2835_files/figure-gfm/scatter plot-1.png" width="90%" />

## Problem 3

``` r
mims_demo = 
  read_csv("./nhanes_covar.csv", skip = 4)
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
mims_acc = 
  read_csv("./nhanes_accel.csv") |> 
  pivot_longer(
    min1:min1440, 
    names_to = "minute",
    values_to = "MIMS_value") |> 
  mutate(
    minute = sub("min", "", minute)
  ) 
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
